---
title: "R Notebook"
output: html_document
---

# JuliaConnectoR (better)
```{r}
library(JuliaConnectoR)
juliaSetupOk()

# setup project
juliaEval("using Pkg; Pkg.status()")
juliaEval("Pkg.activate(\"../../JDRPM\")")
juliaEval("using Pkg; Pkg.status()")

# examples
# which we dont need if we activate the project
# juliaEval("using Random; Random.seed!(5);")
# juliaEval("using Statistics")
# juliaEval("using Logging")
# juliaEval("using Distributions")
# juliaEval("rand(Beta(10,10))")
```

```{r}
# Importing a module without a package
getwd()
testModule = normalizePath("../../JDRPM/src/JDRPM.jl")
cat(testModule)
# take a look at the file
# writeLines(readLines(testModule))
# load in Julia
# juliaCall("include", testModule)
# import in R via relative module path
# TestModule1 <- juliaImport(".JDRPM")

# Importing a local module is also possible in one line,
# by directly using the module object returned by "include".
TestModule1 <- juliaImport(juliaCall("include", testModule))
x = TestModule1$my_example(30)

n = 5
bigT = 3
p = 2
# nxbigT matrix of normally distributed random numbers
Y <- matrix(rnorm(n * bigT), nrow = n, ncol = bigT)
# nx3xbigT array of normally distributed random numbers
X_covariates <- array(rnorm(n * p * bigT), dim = c(n, p, bigT))
# nx2 matrix of uniformly distributed random numbers between 0 and 1
sp_coords <- matrix(runif(n * 2), nrow = n, ncol = 2)
```


```{r}
seed_choice = round(runif(1,0,1000))
set.seed(seed_choice)
```

## fit

```{r}
TestModule1 <- juliaImport(juliaCall("include", testModule))
out = TestModule1$MCMC_fit(
	Y=Y,              
	sp_coords = sp_coords,             
	Xlk_covariates = X_covariates,
	# Xcl_covariates = ,
	M_dp = 19,                     
	# initial_partition = NA,     
	starting_alpha = 0.5,         
	unit_specific_alpha = FALSE,       
	time_specific_alpha = TRUE,       
	update_alpha = TRUE,             
	
	include_eta1 = TRUE,                    
	include_phi1 = TRUE,
	update_eta1 = TRUE,                    
	update_phi1 = TRUE,
	
	sig2h_priors = c(3,1),
	eta1_priors = c(1,2),
	beta_priors = c(rep(1,p),2),
	tau2_priors = c(1,2),
	phi0_priors = c(1,2),
	phi1_priors = 2,
	lambda2_priors = c(1,2),
	alpha_priors = c(1,1),  
	
	spatial_cohesion_idx = 1,
	sp_params = 0.5,
	# sp_params = c(0.5,1),
	# spatial_cohesion_idx = 3,
	# sp_params = list(c(1,2),1,2,matrix(c(1,2,2,4),nrow=2)),
	
	# covariate_similarity_idx = NA,  
	draws = 6,                    
	burnin = 2,                   
	thin = 2,                     
	verbose = TRUE,
	seed = seed_choice
)
```

## explore output
```{r}
rout = juliaGet(out)
names(rout) <- c("Si_iter", "gamma_iter")
rout
```


## close log
```{r}
TestModule1$close_log_file()
```









